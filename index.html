<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>VR Explorer</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.5.0/aframe.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: black;
      color: white;
      text-align: center;
    }
    h1 {
      font-size: 3em;
      margin-top: 40px;
    }
    h2 {
      font-size: 2em;
      margin-top: 40px;
      margin-bottom: 20px;
    }
    h3 {
      font-size: 1.5em;
      margin-top: 30px;
      margin-bottom: 10px;
    }
    select {
      width: 200px;
      font-size: 1em;
      padding: 5px;
      margin: 5px 0;
    }
    #goButton {
      display: inline-block;
      padding: 10px 30px;
      margin-top: 15px;
      font-size: 1.5em;
      background-color: grey;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #goButton.enabled {
      background-color: green;
    }
    .optional-setting {
      margin-top: 20px;
      font-size: 1.1em;
    }
    .toggle-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    .toggle-label {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    .toggle-label input {
      display: none;
    }
    .toggle-slider {
      width: 50px;
      height: 25px;
      background-color: #ccc;
      border-radius: 25px;
      position: relative;
      margin-left: 10px;
    }
    .toggle-slider::before {
      content: "";
      position: absolute;
      width: 23px;
      height: 23px;
      left: 1px;
      top: 1px;
      background-color: white;
      border-radius: 50%;
      transition: 0.3s;
    }
    .toggle-label input:checked + .toggle-slider::before {
      transform: translateX(25px);
    }
    .toggle-label input:checked + .toggle-slider {
      background-color: green;
    }
    #vrScene {
      display: none;
      width: 100vw;
      height: 100vh;
    }
    #ipdSliderContainer {
      display: none;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 10px;
      color: white;
      z-index: 1000;
    }
    #footer {
      font-size: 0.8em;
      font-style: italic;
      margin: 40px 0 20px 0;
    }
  </style>
</head>
<body>

  <h1>VR Explorer</h1>

  <!-- Step 1 -->
  <h2>Step 1: Select Simulation</h2>
  <div id="step1">
    <div>
      <label>Presentation Audiences:</label><br>
      <select id="audienceSelect">
        <option value="">--Select Option--</option>
      </select>
    </div>
    <div style="margin:10px 0; font-weight:bold;">or</div>
    <div>
      <label>Special Scenarios:</label><br>
      <select id="scenarioSelect">
        <option value="">--Select Option--</option>
      </select>
    </div>
  </div>

  <!-- Step 2 -->
  <h2>Step 2: Enter Simulation</h2>
  <button id="goButton">Go</button>

  <!-- Optional Settings -->
  <div class="optional-setting">Optional Settings</div>
  <div class="toggle-group">
    <label class="toggle-label">Safe Mode 1
      <input type="radio" name="safeMode" value="1">
      <div class="toggle-slider"></div>
    </label>
    <label class="toggle-label">Safe Mode 2
      <input type="radio" name="safeMode" value="2">
      <div class="toggle-slider"></div>
    </label>
  </div>

  <div id="footer">
    VR Explorer 1.1 brought to you by Cambridge VR
  </div>

  <!-- VR Scene -->
  <a-scene id="vrScene" embedded vr-mode-ui="enterVRButton:true" renderer="antialias:true">
    <a-assets id="assets"></a-assets>
    <a-camera id="camera"></a-camera>
  </a-scene>

  <!-- IPD Slider -->
  <div id="ipdSliderContainer">
    <label>IPD: <input type="range" id="ipdSlider" min="0.05" max="0.08" step="0.001" value="0.064"></label>
  </div>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script>
    // ---------- Video Links ----------
    const audienceVideos = {
      "Audience of 0": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N0-CF.h264.mp4",
      "Audience of 1": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N1-CF.h264.mp4",
      "Audience of 2": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N2-CF.h264.mp4",
      "Audience of 4": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N4-CF.h264.mp4",
      "Audience of 9": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N9-CF.h264.mp4",
      "Audience of 16": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N16-CF.h264.mp4",
      "Audience of 25": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N25-CF.h264.mp4",
      "Audience of 50": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N50-CF.h264.mp4",
      "Audience of 100": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N100-CF.h264.mp4",
      "Audience of 500": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N500-CF.h264.mp4",
      "Audience of 1000s": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N10K-CF.h264.mp4"
    };

    const scenarioVideos = {
      "TV teleprompter": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/ACC01-CF.h264.mp4",
      "Job interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/JIC01-CF.h264.mp4",
      "Radio interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/RIC01-CF.h264.mp4"
    };

    const youtubeAudience = {
      "Audience of 0": "https://www.youtube.com/watch?v=8D5ZJjV-9No&feature=youtu.be",
      "Audience of 1": "https://www.youtube.com/watch?v=L61TY-lVWYc&feature=youtu.be",
      "Audience of 2": "https://www.youtube.com/watch?v=jisLJabMOaw&feature=youtu.be",
      "Audience of 4": "https://www.youtube.com/watch?v=583YioSTgGE&feature=youtu.be",
      "Audience of 9": "https://www.youtube.com/watch?v=7AS7NEA9PFo&feature=youtu.be",
      "Audience of 16": "https://www.youtube.com/watch?v=_y-lSw1SNaU&feature=youtu.be",
      "Audience of 25": "https://www.youtube.com/watch?v=CBBwXbX5ogE",
      "Audience of 50": "https://www.youtube.com/watch?v=RUnKCfWFSfI",
      "Audience of 100": "https://www.youtube.com/watch?v=ww986pYF46E",
      "Audience of 500": "https://www.youtube.com/watch?v=S3Ve7FGfjWk",
      "Audience of 1000s": "https://www.youtube.com/watch?v=jyUNFPBmJkA"
    };

    const youtubeScenario = {
      "TV teleprompter": "https://www.youtube.com/watch?v=3ZNddx_YNc0",
      "Job interview": "https://www.youtube.com/watch?v=-tsxJfabw0s",
      "Radio interview": "https://www.youtube.com/watch?v=sE3pahN4BwI"
    };

    // ---------- Populate dropdowns ----------
    const audienceSelect = document.getElementById('audienceSelect');
    for (let key in audienceVideos) {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = key;
      audienceSelect.appendChild(opt);
    }
    const scenarioSelect = document.getElementById('scenarioSelect');
    for (let key in scenarioVideos) {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = key;
      scenarioSelect.appendChild(opt);
    }

    // ---------- Enable Go button ----------
    const goButton = document.getElementById('goButton');
    function updateGoButton() {
      if(audienceSelect.value || scenarioSelect.value) {
        goButton.classList.add('enabled');
      } else {
        goButton.classList.remove('enabled');
      }
    }
    audienceSelect.addEventListener('change', updateGoButton);
    scenarioSelect.addEventListener('change', updateGoButton);

    // ---------- Safe Mode ----------
    const safeRadios = document.getElementsByName('safeMode');
    let selectedSafeMode = null;
    safeRadios.forEach(r => r.addEventListener('change', ()=>{ selectedSafeMode=r.value; }));

    // ---------- VR Scene ----------
    const vrScene = document.getElementById('vrScene');
    const ipdContainer = document.getElementById('ipdSliderContainer');
    const ipdSlider = document.getElementById('ipdSlider');
    const camera = document.getElementById('camera');

    goButton.addEventListener('click', ()=>{
      if(!goButton.classList.contains('enabled')) return;

      let selection = audienceSelect.value || scenarioSelect.value;
      if(!selection) return;

      // Decide URL based on Safe Mode
      let url = null;
      if(selectedSafeMode==="1") {
        // Safe Mode 1: YouTube
        url = audienceVideos[selection]? youtubeAudience[selection] : youtubeScenario[selection];
        window.open(url,'_blank');
        return;
      } else if(selectedSafeMode==="2") {
        // Safe Mode 2: Cloudflare with IPD slider
        url = audienceVideos[selection] || scenarioVideos[selection];
        loadVRVideo(url,true); // true = enable IPD slider in VR
        return;
      } else {
        // Default mode
        url = audienceVideos[selection] || scenarioVideos[selection];
        loadVRVideo(url,false);
      }
    });

    function loadVRVideo(url, enableIPD=false){
      const assets=document.getElementById('assets');
      assets.innerHTML='';
      const oldSphere=document.querySelector('a-videosphere');
      if(oldSphere) oldSphere.remove();

      const video=document.createElement('video');
      video.id='vrVideo';
      video.src=url;
      video.crossOrigin='anonymous';
      video.loop=true;
      video.autoplay=true;
      video.setAttribute('playsinline','');
      video.setAttribute('webkit-playsinline','');
      video.muted=false;
      assets.appendChild(video);

      video.addEventListener('loadeddata',()=>{
        vrScene.style.display='block';
        const sphere=document.createElement('a-videosphere');
        sphere.setAttribute('src','#vrVideo');
        vrScene.appendChild(sphere);
        video.play().catch(err=>console.error('Video play failed:',err));

        if(enableIPD){
          ipdContainer.style.display='block';
        } else {
          ipdContainer.style.display='none';
        }
      });
    }

    // ---------- IPD slider ----------
    ipdSlider.addEventListener('input', ()=>{
      const separation = parseFloat(ipdSlider.value);
      camera.setAttribute('camera','userHeight:1.6;');
      camera.getObject3D('camera').children.forEach(c=>c.position.x = (c.el==camera)?0:separation);
    });

  </script>
</body>
</html>
