<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>VR Explorer</title>
<link rel="manifest" href="manifest.json">
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background-color: black;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1, h2 {
    text-align: center;
    margin: 10px 0;
  }
  h1 { margin-top: 40px; }
  select, button {
    font-size: 1rem;
    padding: 8px;
    margin: 5px 0;
  }
  .step {
    margin: 30px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .footer {
    font-size: 0.75rem;
    font-style: italic;
    margin-bottom: 20px;
    margin-top: 20px;
  }
  .safe-mode {
    display: flex;
    flex-direction: column;
    margin: 10px 0;
  }
  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
    margin-left: 10px;
  }
  .toggle-switch input { display:none; }
  .slider {
    position: absolute;
    cursor: pointer;
    top:0; left:0; right:0; bottom:0;
    background-color: #ccc;
    border-radius: 34px;
    transition: .4s;
  }
  .slider:before {
    position: absolute;
    content:"";
    height: 22px;
    width: 22px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    border-radius: 50%;
    transition: .4s;
  }
  input:checked + .slider { background-color: #4CAF50; }
  input:checked + .slider:before { transform: translateX(30px); }
  #goButton:disabled { background-color: grey; color: #999; cursor: not-allowed; }
  #goButton { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
  .dropdown-title { font-weight: normal; margin-top: 15px; }
</style>
</head>
<body>

<h1>VR Explorer</h1>

<div class="step">
  <h2>Step 1: Select Simulation</h2>

  <div class="dropdown-title">Presentation Audiences:</div>
  <select id="audienceSelect">
    <option value="">--select option--</option>
  </select>

  <div style="margin: 10px 0; font-weight: bold;">or</div>

  <div class="dropdown-title">Special Scenarios:</div>
  <select id="scenarioSelect">
    <option value="">--select option--</option>
  </select>
</div>

<div class="step">
  <h2>Step 2: Enter Simulation</h2>
  <button id="goButton" disabled>Go</button>

  <div class="safe-mode">
    Laptop Safe Mode
    <label class="toggle-switch">
      <input type="checkbox" id="safeModeLaptop">
      <span class="slider"></span>
    </label>
  </div>
  <div class="safe-mode">
    Android Safe Mode
    <label class="toggle-switch">
      <input type="checkbox" id="safeModeAndroid">
      <span class="slider"></span>
    </label>
  </div>
  <div class="safe-mode">
    iPhone Safe Mode
    <label class="toggle-switch">
      <input type="checkbox" id="safeModeIphone">
      <span class="slider"></span>
    </label>
  </div>
</div>

<div class="footer">VR Explorer 1.1 brought to you by Cambridge VR</div>

<a-scene embedded id="vrScene" vr-mode-ui="enabled: true" arjs="enabled: false" style="display:none;">
</a-scene>

<script>
// ----------------- VIDEO LINKS -----------------
const audienceVideos = {
  "Audience of 0": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N0-CF.h264.mp4",
  "Audience of 1": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N1-CF.h264.mp4",
  "Audience of 2": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N2-CF.h264.mp4",
  "Audience of 4": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N4-CF.h264.mp4",
  "Audience of 9": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N9-CF.h264.mp4",
  "Audience of 16": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N16-CF.h264.mp4",
  "Audience of 25": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N25-CF.h264.mp4",
  "Audience of 50": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N50-CF.h264.mp4",
  "Audience of 100": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N100-CF.h264.mp4",
  "Audience of 500": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N500-CF.h264.mp4",
  "Audience of 1000s": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N10K-CF.h264.mp4"
};

const scenarioVideos = {
  "TV teleprompter": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/ACC01-CF.h264.mp4",
  "Job interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/JIC01-CF.h264.mp4",
  "Radio interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/RIC01-CF.h264.mp4"
};

// Populate dropdowns
const audienceSelect = document.getElementById('audienceSelect');
for(const key in audienceVideos){
  let opt = document.createElement('option');
  opt.value = key;
  opt.text = key;
  audienceSelect.appendChild(opt);
}
const scenarioSelect = document.getElementById('scenarioSelect');
for(const key in scenarioVideos){
  let opt = document.createElement('option');
  opt.value = key;
  opt.text = key;
  scenarioSelect.appendChild(opt);
}

// Enable Go button only when a selection is made
const goButton = document.getElementById('goButton');
function updateGoState(){
  if(audienceSelect.value || scenarioSelect.value) goButton.disabled = false;
  else goButton.disabled = true;
}
audienceSelect.addEventListener('change', updateGoState);
scenarioSelect.addEventListener('change', updateGoState);

// ----------------- VR INIT -----------------
const scene = document.getElementById('vrScene');
goButton.addEventListener('click', async () => {
  const selected = audienceSelect.value || scenarioSelect.value;
  if(!selected) return;

  const safeLaptop = document.getElementById('safeModeLaptop').checked;
  const safeAndroid = document.getElementById('safeModeAndroid').checked;
  const safeIphone = document.getElementById('safeModeIphone').checked;

  let videoURL;
  if(safeLaptop || safeAndroid){
    // Safe Mode 1: YouTube
    const ytLinks = {
      ...audienceVideos, ...scenarioVideos
    };
    videoURL = ytLinks[selected].replace('.mp4', ''); // remove .mp4 if needed
    window.open(videoURL, '_blank');
    return;
  } else if(safeIphone){
    // Safe Mode 2: iPhone hosted version
    const iphoneLinks = {
      "Audience of 0":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N0-CF",
      "Audience of 1":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N1-CF",
      "Audience of 2":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N2-CF",
      "Audience of 4":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N4-CF",
      "Audience of 9":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N9-CF",
      "Audience of 16":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N16-CF",
      "Audience of 25":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N25-CF",
      "Audience of 50":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N50-CF",
      "Audience of 100":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N100-CF",
      "Audience of 500":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N500-CF",
      "Audience of 1000s":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=N10K-CF",
      "TV teleprompter":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=ACC01-CF",
      "Job interview":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=JIC01-CF",
      "Radio interview":"https://testing.virtual-reality-publics-peaking-player.pages.dev/?video=RIC01-CF"
    };
    window.open(iphoneLinks[selected], '_blank');
    return;
  } else {
    // Default VR: Cloudflare hosted videos
    videoURL = audienceVideos[selected] || scenarioVideos[selected];

    // Clear previous video if exists
    const oldVideo = document.getElementById('vrVideo');
    if(oldVideo) oldVideo.remove();
    scene.innerHTML = '';

    const videoEl = document.createElement('video');
    videoEl.src = videoURL;
    videoEl.crossOrigin = 'anonymous';
    videoEl.loop = true;
    videoEl.muted = true; // required for mobile autoplay
    videoEl.setAttribute('playsinline','true');
    videoEl.id = 'vrVideo';
    document.body.appendChild(videoEl);

    videoEl.addEventListener('canplay', async () => {
      try{
        await videoEl.play();
        // unmute after user interaction (Go button)
        videoEl.muted = false;

        const videosphere = document.createElement('a-videosphere');
        videosphere.setAttribute('src', '#vrVideo');
        scene.appendChild(videosphere);
        scene.style.display = 'block';
      } catch(err){
        console.log('Video play error:', err);
      }
    });
  }
});
</script>

</body>
</html>
